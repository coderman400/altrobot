<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DOCX Upload</title>
  </head>
  <body>
    <h2>Upload DOCX File</h2>
    <input type="file" id="fileInput" accept=".docx" />
    <button onclick="uploadFile()">Upload</button>
    <div id="output"></div>

    <script>
      async function uploadFile() {
        const fileInput = document.getElementById("fileInput");
        if (fileInput.files.length === 0) {
          alert("Please select a file.");
          return;
        }

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        try {
          const uploadResponse = await fetch("http://127.0.0.1:8000/upload", {
            method: "POST",
            body: formData,
          });

          if (!uploadResponse.ok) throw new Error("Upload failed");
          const { file_id } = await uploadResponse.json();

          const processResponse = await fetch(`http://127.0.0.1:8000/process/${file_id}`, {
            method: "POST",
          });

          if (!processResponse.ok) throw new Error("Processing failed");
          const { url } = await processResponse.json();

          document.getElementById(
            "output"
          ).innerHTML = `<a href="http://127.0.0.1:8000/${url}" target="_blank"><button>Download Processed File</button></a>`;
        } catch (error) {
          document.getElementById("output").innerText =
            "Error: " + error.message;
        }
      }
    </script>
  </body>
</html>
